"use strict";(self.webpackChunkskillsnetwork_authoring_extension=self.webpackChunkskillsnetwork_authoring_extension||[]).push([[568],{7953:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{Z:()=>m});var a=n(3619),l=n(2884),s=n(5923),i=n(9448),r=n(8623),c=n(3311),u=n(6973),d=n(405),h=n(5679),w=n(5449),b=t([d,r,c,w]);[d,r,c,w]=b.then?(await b)():b;const g={activate:y,id:"skillsnetwork-authoring-extension:plugin",autoStart:!0,requires:[i.IMainMenu,h.INotebookTracker,a.IDocumentManager]};class p{createNew(t,e){if(d.OH.SHOW_PUBLISH_BUTTON_FOR!==e.path)return new s.DisposableDelegate((()=>{}));{const n=async()=>{const n=await(0,r.nu)(t,e),o=d.OH.TOKENS.get(t.id);void 0!==o?(0,c.nK)((0,c.SJ)(o),n):console.log("No atlas token found for id",t.id)},o=new l.ToolbarButton({className:"publish-lab-button",label:"Publish on SN",onClick:n,tooltip:"Publish Lab"}),a=new l.ToolbarButton({className:"sn-file-library-button",label:"SN File Library",onClick:()=>new w.E(t.id).launch(),tooltip:"Skills Network File Library"});return t.toolbar.insertItem(9,"sn-file-library",a),t.toolbar.insertItem(10,"publish",o),new s.DisposableDelegate((()=>{o.dispose(),a.dispose()}))}}}async function y(t,e,n,o){if(console.log("Activated skillsnetwork-authoring-extension button plugin!"),"learn"==await(0,d.IK)())return;const a=await(0,d.Nz)(),s=await(0,d.D2)();console.log("Using default kernel: ",d.OH.PY_KERNEL_NAME),t.docRegistry.addWidgetExtension("Notebook",new p),t.restored.then((async()=>{if("NO_TOKEN"!==a&&"local"!==s)try{await(0,r._Y)(a,o)}catch(t){l.Dialog.flush(),(0,u.YZ)(),console.log(t)}}))}const m=g;o()}catch(f){o(f)}}))},405:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{CC:()=>s,D2:()=>c,IK:()=>i,Nz:()=>r,OH:()=>d,XM:()=>l});var a=n(5613);const t=t=>{let e=t.baseUrl;return e.endsWith("/")||(e+="/"),e},l=await(async()=>{const e=window.location.href,n=new URL(e).searchParams.get("atlas_base_url");if(null===n){const e={method:"GET"},n=a.ServerConnection.makeSettings(),o=t(n)+"skillsnetwork-authoring-extension/config",l=await a.ServerConnection.makeRequest(o,e,n);return(await l.json()).ATLAS_BASE_URL}return decodeURIComponent(n)})(),s=await(async()=>{const e=window.location.href,n=new URL(e).searchParams.get("sn_file_library_url");if(null===n){const e={method:"GET"},n=a.ServerConnection.makeSettings(),o=t(n)+"skillsnetwork-authoring-extension/config",l=await a.ServerConnection.makeRequest(o,e,n);return(await l.json()).SN_FILE_LIBRARY_URL}return decodeURIComponent(n)})(),i=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("mode");return"learn"==e?e:"author"},r=async()=>{const t=window.location.href,e=new URL(t).searchParams.get("atlas_token");return null!==e?e:"NO_TOKEN"},c=async()=>{const t=window.location.href;let e=new URL(t).searchParams.get("env_type");return"jupyterlab"!==e&&"jupyterlite"!==e&&(e="local"),console.log("Env type: ",e),"jupyterlab"===e||"local"===e?(d.PY_KERNEL_NAME=await u(),d.DEFAULT_LAB_NAME="lab.ipynb"):"jupyterlite"===e&&(d.PY_KERNEL_NAME="python",d.DEFAULT_LAB_NAME="lab.jupyterlite.ipynb"),e},u=async()=>{let t=await(await a.KernelSpecAPI.getSpecs()).kernelspecs,e=Object.keys(t).filter((function(t){return t.includes("python")})).sort();return e[e.length-1]};class d{}d.TOKENS=new Map,d.SHOW_PUBLISH_BUTTON_FOR=void 0,o()}catch(t){o(t)}}),1)},6973:(t,e,n)=>{n.d(e,{Up:()=>s,YZ:()=>d,fP:()=>u,ql:()=>r,wW:()=>c,wj:()=>i});var o=n(1431),a=n(2884);class l extends o.Widget{constructor(){const t=document.createElement("div"),e=new a.Spinner;t.appendChild(e.node),t.style.padding="15px",super({node:t})}}const s=t=>{const e=new l;(0,a.showDialog)({title:t,body:e,buttons:[a.Dialog.cancelButton()]})},i=t=>{const e=new l;return(0,a.showDialog)({title:t,body:e,buttons:[]})},r=t=>(0,a.showDialog)({title:t,body:"Are you sure you want to publish? This action is not reversible",buttons:[a.Dialog.okButton(),a.Dialog.cancelButton()]}).then((t=>{if(!t.button.accept)throw new Error("Operation cancelled by the user.")})),c=()=>{(0,a.showDialog)({title:"Success!",body:"This lab has been successfully published!",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},u=()=>{(0,a.showDialog)({title:"Failed to Publish",body:"This lab failed to publish.",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))},d=()=>{(0,a.showDialog)({title:"Failed to Load Lab",body:"This lab failed to load.",buttons:[a.Dialog.okButton()]}).then((t=>{})).catch((t=>{}))}},3311:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{B4:()=>d,SJ:()=>u,nK:()=>h});var a=n(6973),l=n(2884),s=n(405),i=n(9581),r=n.n(i),c=t([s]);s=(c.then?(await c)():c)[0];const u=t=>r().create({baseURL:s.XM,headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),d=t=>t.get("v1/labs").then((t=>(l.Dialog.flush(),t.data))).catch((t=>{throw console.log(t),"Failed to fetch notebook"})),h=async(t,e)=>{if(await(0,a.ql)("Publishing your lab onto Skills Network...").then((t=>!0)).catch((t=>!1)))return(0,a.wj)("Publishing your changes..."),new Promise((async(n,o)=>{await t.post("v1/labs",{body:e}).then((t=>{console.log("SUCCESSFULLY PUSHED",t),l.Dialog.flush(),(0,a.wW)()})).catch((t=>{console.log(t),l.Dialog.flush(),(0,a.fP)()}))}))};o()}catch(t){o(t)}}))},1568:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.r(e),n.d(e,{default:()=>i});var a=n(4822),l=n(7953),s=t([l,a]);[l,a]=s.then?(await s)():s;const i=[l.Z,a.G];o()}catch(t){o(t)}}))},4822:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{G:()=>w});var a=n(9448),l=n(1431),s=n(2884),i=n(5679),r=n(3619),c=n(6973),u=n(405),d=n(8623),h=t([u,d]);[u,d]=h.then?(await h)():h;const w={id:"skillsnetwork-authoring-extension:menu",autoStart:!0,requires:[a.IMainMenu,i.INotebookTracker,r.IDocumentManager],activate:async(t,e,n,o)=>{if(console.log("Activated skillsnetwork-authoring-extension menu plugin!"),"learn"==await(0,u.IK)())return;const a="edit-lab-from-token";t.commands.addCommand(a,{label:"Edit a Lab",execute:()=>{h(n,o)}});const{commands:i}=t,r=new l.Menu({commands:i});r.title.label="Skills Network",e.addMenu(r,{rank:80}),r.addItem({command:a,args:{}});const h=(t,e)=>{let n=document.createElement("div"),o=document.createElement("label");o.textContent="Enter your authorization token: ";let a=document.createElement("input");a.className="jp-mod-styled",n.appendChild(o),n.appendChild(a),(0,s.showDialog)({title:"Edit a Lab",body:new l.Widget({node:n}),buttons:[s.Dialog.cancelButton(),s.Dialog.okButton()]}).then((async t=>{if(t.button.accept){(0,c.Up)("Loading up your lab...");const t=a.value;await(0,d._Y)(t,e)}})).catch((t=>{s.Dialog.flush(),(0,c.YZ)(),console.log(t)}))}}};o()}catch(t){o(t)}}))},5449:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{E:()=>d});var a=n(1431),l=n(2884),s=n(405),i=t([s]);s=(i.then?(await i)():i)[0];var r,c=function(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)};class u extends a.Widget{constructor(t){const e=document.createElement("iframe");e.src=`${s.CC}?atlas_token=${s.OH.TOKENS.get(t)}`,e.setAttribute("frameborder","0"),e.setAttribute("allow","clipboard-read; clipboard-write"),e.classList.add("sn-file-library-frame"),super({node:e})}}class d{constructor(t){r.set(this,void 0),function(t,e,n){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");e.set(t,n)}(this,r,t)}launch(){const t=new l.Dialog({title:"Skills Network File Library",body:new u(c(this,r)),hasClose:!0,buttons:[]}),e=t.node.querySelector(".jp-Dialog-content");e&&e.classList.add("sn-file-library-dialog"),t.launch()}}r=new WeakMap,o()}catch(t){o(t)}}))},8623:(t,e,n)=>{n.a(t,(async(t,o)=>{try{n.d(e,{_Y:()=>u,nu:()=>c});var a=n(5679),l=n(405),s=n(3311),i=t([s,l]);[s,l]=i.then?(await i)():i;const r=t=>({cell_type:t.model.type,id:t.model.id,metadata:{},outputs:[],source:[t.model.value.text]}),c=(t,e)=>{const n=[];t.content.widgets.forEach((t=>{const e=r(t);n.push(e)}));const o=e.model.metadata.toJSON(),a=e.model.nbformat,l=e.model.nbformatMinor,s={cells:n,metadata:o,nbformat:a,nbformat_minor:l};return JSON.stringify(s,null,2)},u=async(t,e)=>{let{instructions_file_path:n,body:o}=await(0,s.B4)((0,s.SJ)(t));const a=h(n);l.OH.SHOW_PUBLISH_BUTTON_FOR=a;const i=e.createNew(a,"notebook",{name:l.OH.PY_KERNEL_NAME});if(l.OH.SHOW_PUBLISH_BUTTON_FOR=void 0,l.OH.TOKENS.set(i.id,t),void 0===i)throw Error("Error loading lab");return d(i,JSON.parse(o)),i},d=(t,e,n)=>{const o=new a.NotebookModel;"local"!==n&&o.fromJSON(e),t.content.model=o},h=t=>(null!=t?t:l.OH.DEFAULT_LAB_NAME).replace(/^.*[\\\/]/,"");o()}catch(t){o(t)}}))}}]);