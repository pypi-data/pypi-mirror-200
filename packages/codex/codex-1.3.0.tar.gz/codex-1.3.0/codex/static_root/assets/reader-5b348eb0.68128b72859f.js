import{a as f,bm as u,b,c as m,o as d,e as h,w as l,k as g,t as k,bn as ae,bo as se,g as s,E as P,B as C,f as S,bp as I,ao as B,D as y,d as v,bq as Fe,br as He,j as r,aD as L,bl as ne,bs as We,bt as Ge,bu as Me,bv as re,r as M,bw as ie,F as T,bx as le,by as ce,be as E,b8 as qe,b2 as W,aW as Ke,bz as je,M as Ye,aH as de,J as Xe,K as D,as as G,aY as q,at as Je,au as Ze,bA as Qe,bB as et,bC as tt,bD as ot,bE as at,n as K,p as j,N as ue,bF as st,T as ge,bG as pe,bH as nt,bI as rt,bJ as it,bK as Y,a9 as lt,bL as ct,bd as dt,bM as ut,bN as gt,bO as _e,bP as pt,bQ as _t,aA as F,bR as ht,bS as mt,bT as kt,bU as vt,bV as bt,bW as ft,bX as Pt,bY as wt,bZ as St,b_ as yt,q as Ct,v as Rt,V as X,bk as he,C as J,bj as Bt,b$ as Tt,bh as Z,c0 as It}from"./admin-f52fd237.js";import{_ as O,a as me,b as ke,P as ve,c as be}from"./metadata-dialog-98443734.js";const Dt={name:"ReaderNavButton",components:{PaginationNavButton:O},props:{value:{type:Number,required:!0},twoPages:{type:Boolean,default:!1}},computed:{...f(u,{storePage:e=>e.page,vertical:e=>{var t;return(t=e.activeSettings)==null?void 0:t.vertical},toRoute(e){return{params:{pk:e.pk,page:this.value}}}}),title(){return"to page "+this.value},disabled(){return this.value===this.storePage||this.twoPages&&!!(this.value%2)&&this.value-1===this.storePage}},methods:{...b(u,["setPage"]),onClick(){this.setPage(this.value,!0)}}};function $t(e,t,a,c,i,o){const n=O;return e.vertical?(d(),h(n,{key:0,disabled:o.disabled,title:o.title,onClick:o.onClick},{default:l(()=>[g(k(a.value),1)]),_:1},8,["disabled","title","onClick"])):(d(),h(n,{key:1,disabled:o.disabled,title:o.title,to:e.toRoute},{default:l(()=>[g(k(a.value),1)]),_:1},8,["disabled","title","to"]))}const fe=m(Dt,[["render",$t]]),Vt={name:"ReaderBookChangeNavButton",components:{PaginationNavButton:O},props:{direction:{type:String,required:!0}},computed:{...f(u,{toRoute(e){const t=e.routes.books;if(!t)return"";const a=t[this.direction];return a?{params:{...a}}:""}}),title(){return(this.direction==="prev"?"Previous":"Next")+" Book"},icon(){return this.direction==="prev"?ae:se},disabled(){return!this.toRoute}}};function xt(e,t,a,c,i,o){const n=O;return d(),h(n,{icon:"",variant:"plain",disabled:o.disabled,title:o.title,to:e.toRoute},{default:l(()=>[s(P,null,{default:l(()=>[g(k(o.icon),1)]),_:1})]),_:1},8,["disabled","title","to"])}const Pe=m(Vt,[["render",xt]]),V="prev",x="next",Lt={name:"ReaderNavToolbar",components:{PaginationSlider:me,ReaderNavButton:fe,PaginationToolbar:ke,ReaderBookChangeNavButton:Pe},computed:{...C(u,["activeSettings","activeBook"]),...f(u,{storePage:e=>e.page,key(e){return`${e.pk} - ${this.twoPages}`}}),maxPage(){return this.activeBook?this.activeBook.maxPage:0},twoPages(){return this.activeSettings.twoPages},step(){return this.activeSettings.twoPages?2:1},trackColor(){return this.twoPages&&+this.storePage>=this.maxPage-1?this.$vuetify.theme.current.colors.primary:""},readInReverse(){return this.activeSettings.readInReverse},min(){return this.readInReverse?this.maxPage:0},max(){return this.readInReverse?0:this.maxPage},bookPrev(){return this.readInReverse?"next":"prev"},bookNext(){return this.readInReverse?"prev":"next"}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...b(u,["routeToBook","routeToDirection","routeToDirectionOne","routeToPage","setPage"]),onSliderUpdate(e){this.activeSettings.vertical?this.setPage(e,!0):this.routeToPage(e)},_keyListener(e){switch(e.stopPropagation(),e.key){case" ":!e.shiftKey&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight?this.routeToDirection(x):e.shiftKey&&window.scrollY===0&&this.routeToDirection(V);break;case"j":case"ArrowRight":this.routeToDirection(x);break;case"k":case"ArrowLeft":this.routeToDirection(V);break;case",":this.routeToDirectionOne(V);break;case".":this.routeToDirectionOne(x);break;case"n":this.routeToBook(x);break;case"p":this.routeToBook(V);break}}}};function Et(e,t,a,c,i,o){const n=Pe,p=fe,_=me,R=ke;return o.maxPage?(d(),h(R,{key:0},{default:l(()=>[s(n,{direction:o.bookPrev},null,8,["direction"]),s(p,{value:o.min,"two-pages":o.twoPages},null,8,["value","two-pages"]),(d(),h(_,{key:e.key,"model-value":e.storePage,min:0,max:o.maxPage,step:o.step,"track-color":o.trackColor,reverse:o.readInReverse,"onUpdate:modelValue":t[0]||(t[0]=$=>o.onSliderUpdate($))},null,8,["model-value","max","step","track-color","reverse"])),s(p,{value:o.max,"two-pages":o.twoPages},null,8,["value","two-pages"]),s(n,{direction:o.bookNext},null,8,["direction"])]),_:1})):S("",!0)}const we=m(Lt,[["render",Et]]),Ot={rel:"prefetch",as:"image"},Se=function(e){const t=[];for(const a of e)a&&t.push({...Ot,href:a});return{link:t}};const Nt={name:"PageChangeLink",props:{direction:{type:String,required:!0}},head(){return Se([this.prefetchSrc1,this.prefetchSrc2])},computed:{...f(u,{params(e){return e.routes[this.computedDirection]},prefetchSrc2(e){const t=e.books.get(this.params.pk);if(!t||!this.getSettings(t).twoPages)return!1;const c={...this.params,page:this.params.page+1};return c.page>t.maxPage?!1:I(c)},directionClass(e){let t=this.direction;return e.activeSettings.vertical&&(t+="Vertical"),t},pageChangeClass(e){let t="pageChange";return t+=e.activeSettings.vertical?"Row":"Column",t}}),computedDirection(){return this.normalizeDirection(this.direction)},prefetchSrc1(){return this.params?I(this.params):!1},route(){return this.params?{params:this.params}:{}},label(){return`${this.computedDirection==="prev"?"Previous":"Next"} Page`}},methods:{...b(u,["getSettings","normalizeDirection"])}};function At(e,t,a,c,i,o){const n=y("router-link");return d(),h(n,{to:o.route,"aria-label":o.label,class:B({[e.pageChangeClass]:!0,[e.directionClass]:!0}),onClick:t[0]||(t[0]=p=>p.stopImmediatePropagation())},null,8,["to","aria-label","class"])}const ye=m(Nt,[["render",At],["__scopeId","data-v-5bd175ef"]]);const Ut={name:"LoadingPage",components:{Placeholder:ve},props:{twoPages:{type:Boolean,required:!0}}};function zt(e,t,a,c,i,o){const n=y("Placeholder");return d(),v("div",{class:B(["pageLoading",{twoPages:a.twoPages}])},[s(n,{class:"pagePlaceholder"})],2)}const Ft=m(Ut,[["render",zt],["__scopeId","data-v-2bc79db9"]]);const Q="unauthorized",Ht={name:"ErrorPage",props:{twoPages:{type:Boolean,required:!0},type:{type:String,required:!0}},computed:{text(){return this.type===Q?"Protected page":"Failed to load page"},icon(){return this.type===Q?Fe:He}}},Wt={class:"pageErrorContainer"},Gt={class:"pageErrorText"};function Mt(e,t,a,c,i,o){return d(),v("div",{class:B(["pageError",{twoPages:a.twoPages}])},[r("div",Wt,[r("div",Gt,k(o.text),1),s(P,{class:"pageErrorIcon"},{default:l(()=>[g(k(o.icon),1)]),_:1})])],2)}const qt=m(Ht,[["render",Mt],["__scopeId","data-v-afc58246"]]);const Kt={name:"ImgPage",props:{src:{type:String,required:!0},fitToClass:{type:Object,required:!0}},emits:["load","error"]},jt=["src"];function Yt(e,t,a,c,i,o){return d(),v("img",L({class:a.fitToClass,src:a.src},e.$attrs,{onError:t[0]||(t[0]=n=>e.$emit("error")),onLoad:t[1]||(t[1]=n=>e.$emit("load"))}),null,16,jt)}const ee=m(Kt,[["render",Yt],["__scopeId","data-v-bcb1c62b"]]);const te=ne(We(()=>Me(()=>import("./page-pdf-dd6d7d23.js"),["assets/page-pdf-dd6d7d23.js","assets/admin-f52fd237.js","assets/admin-8edd0c80.css","assets/page-pdf-0653d653.css"]))),Xt=333,Jt={name:"BookPage",components:{Placeholder:ve,ErrorPage:qt,LoadingPage:Ft,PDFPage:te,ImgPage:ee},props:{book:{type:Object,required:!0},page:{type:Number,required:!0}},data(){return{showProgress:!1,loaded:!1,error:!1}},computed:{pageClass(){return this.settings.vertical?"pageVertical":"pageHorizontal"},fitToClass(){let e={};const t=this.settings.fitTo;if(t){let a="fitTo";a+=t.charAt(0).toUpperCase()+t.slice(1).toLowerCase(),this.settings.twoPages&&(a+="Two",this.settings.vertical&&(a+="Vertical")),e[a]=!0}return e},src(){const e={pk:this.book.pk,page:this.page};return I(e)},component(){return this.book.fileType==="PDF"?te:ee},settings(){return this.getSettings(this.book)}},mounted(){setTimeout(function(){this.loaded||(this.loading=!0)},Xt)},methods:{...b(u,["getSettings"]),onLoad(){this.showProgress=!1,this.loaded=!0,this.error=!1},onError(){this.error="load",this.showProgress=!1},onUnauthorized(){this.error="unauthorized",this.showProgress=!1}}},Zt=["id","data-page"];function Qt(e,t,a,c,i,o){const n=y("ErrorPage"),p=y("LoadingPage");return d(),v("div",{id:`page${a.page}`,"data-page":a.page,class:B(o.pageClass)},[i.error?(d(),h(n,{key:0,"two-pages":o.settings.twoPages,type:i.error},null,8,["two-pages","type"])):i.showProgress&&!i.loaded?(d(),h(p,{key:1,"two-pages":o.settings.twoPages},null,8,["two-pages"])):(d(),h(Ge(o.component),{key:2,src:o.src,"fit-to-class":o.fitToClass,book:a.book,onError:o.onError,onLoad:o.onLoad,onUnauthorized:o.onUnauthorized},null,40,["src","fit-to-class","book","onError","onLoad","onUnauthorized"]))],10,Zt)}const Ce=m(Jt,[["render",Qt],["__scopeId","data-v-643cedfa"]]);const eo={name:"PagesWindowHorizontal",components:{BookPage:Ce,PageChangeLink:ye},props:{book:{type:Object,required:!0}},emits:["click"],data(){return{activePage:0}},computed:{...C(u,["isOnCoverPage"]),...f(u,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},twoPages(){return this.settings.twoPages},readInReverse(){return this.settings.readInReverse},secondPage(){return this.settings.twoPages&&!this.isOnCoverPage},pages(){var t;const e=((t=this.book)==null?void 0:t.maxPage)+1;return re.range(0,e)}},watch:{twoPages(){this.setActivePage(this.storePage)},storePage(e){this.book.pk===this.storePk&&(this.activePage=e)},prevBook(e){this.book.pk===e.pk&&(this.activePage=this.book.maxPage)},nextBook(e){this.book.pk===e.pk&&(this.activePage=0)}},created(){this.book.pk===this.storePk?this.activePage=+this.$route.params.page:this.book.pk===this.prevBook.pk?this.activePage=this.book.maxPage:this.activePage=0},methods:{...b(u,["getSettings","setBookChangeFlag","setActivePage"])}};function to(e,t,a,c,i,o){const n=ye,p=y("BookPage");return d(),h(le,{"show-arrows":"","model-value":e.storePage,reverse:o.readInReverse},{prev:l(()=>[s(n,{direction:"prev"})]),next:l(()=>[s(n,{direction:"next"})]),default:l(()=>[(d(!0),v(T,null,M(o.pages,_=>(d(),h(ie,{key:`c/${a.book.pk}/${_}`,class:"windowItem",disabled:"",eager:_>=e.storePage-1&&_<=e.storePage+2,"model-value":_,transition:!0},{default:l(()=>[!o.readInReverse||o.secondPage&&_<a.book.maxPage?(d(),h(p,{key:0,book:a.book,page:o.readInReverse?_+1:_},null,8,["book","page"])):S("",!0),o.readInReverse||o.secondPage&&_<a.book.maxPage?(d(),h(p,{key:1,book:a.book,page:o.readInReverse?_:_+1},null,8,["book","page"])):S("",!0)]),_:2},1032,["eager","model-value"]))),128))]),_:1},8,["model-value","reverse"])}const Re=m(eo,[["render",to],["__scopeId","data-v-15c2d20c"]]);function Be(e,t){const{self:a=!1}=t.modifiers??{},c=t.value,i=typeof c=="object"&&c.options||{passive:!0},o=typeof c=="function"||"handleEvent"in c?c:c.handler,n=a?e:t.arg?document.querySelector(t.arg):window;n&&(n.addEventListener("scroll",o,i),e._onScroll=Object(e._onScroll),e._onScroll[t.instance.$.uid]={handler:o,options:i,target:a?void 0:n})}function Te(e,t){var o;if(!((o=e._onScroll)!=null&&o[t.instance.$.uid]))return;const{handler:a,options:c,target:i=e}=e._onScroll[t.instance.$.uid];i.removeEventListener("scroll",a,c),delete e._onScroll[t.instance.$.uid]}function oo(e,t){t.value!==t.oldValue&&(Te(e,t),Be(e,t))}const ao={mounted:Be,unmounted:Te,updated:oo},so={name:"PagesScrollerVertical",components:{BookPage:Ce,VVirtualScroll:ce},props:{book:{type:Object,required:!0}},emits:["click"],data(){return{mountedTime:0,innerHeight:window.innerHeight,innerWidth:window.innerWidth}},computed:{...C(u,["isOnCoverPage"]),...f(u,{prevBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.prev},nextBook:e=>{var t;return(t=e.routes.books)==null?void 0:t.next},storePage:e=>e.page,storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},vertical(){return this.settings.vertical},readInReverse(){return this.settings.readInReverse},items(){var a;const e=((a=this.book)==null?void 0:a.maxPage)+1,t=re.range(0,e);return this.readInReverse&&t.reverse(),t}},watch:{vertical(e){e&&this.setActivePage(this.storePage,!0)}},mounted(){window.addEventListener("resize",this.onResize),this.setPage(this.storePage,!0),this.mountedTime=Date.now()},beforeUnmount(){window.removeEventListener("resize",this.onResize)},methods:{...b(u,["setActivePage","setBookChangeFlag","setPage","getSettings"]),onIntersect(e,t){if(this.vertical&&e){const c=+t[0].target.dataset.page;console.log("intersect",c),this.setActivePage(c)}},onScroll(){!this.vertical||Date.now()-this.mountedTime<2||(this.storePage===0&&window.scrollY===0?this.setBookChangeFlag("prev"):this.storePage===this.book.maxPage&&window.innerHeight+window.scrollY+1>=document.body.scrollHeight&&this.setBookChangeFlag("next"))},onResize(){this.innerHeight=window.innerHeight,this.innerWidth=window.innerWidth}}};function no(e,t,a,c,i,o){const n=y("BookPage"),p=ce;return o.settings.vertical?E((d(),h(p,{key:0,id:"verticalScroll",items:o.items,"visible-items":o.items.length,height:i.innerHeight,width:i.innerWidth,"item-height":i.innerHeight},{default:l(({item:_})=>[E(s(n,{book:a.book,page:_},null,8,["book","page"]),[[qe,{handler:o.onIntersect,options:{threshold:[.01],rootMargin:"-40%"}},void 0,{quiet:!0}]])]),_:1},8,["items","visible-items","height","width","item-height"])),[[ao,o.onScroll,void 0,{target:!0}]]):S("",!0)}const Ie=m(so,[["render",no]]),ro={name:"PagesView",components:{PagesWindowHorizontal:Re,PagesScrollerVertical:Ie},props:{book:{type:Object,required:!0}},emits:["click"],computed:{...f(u,{storePk:e=>e.pk}),settings(){return this.getSettings(this.book)},vertical(){return this.settings.vertical}},watch:{$route(e){+e.params.pk===this.book.pk&&this.setActivePage(+e.params.page,!0)}},created(){this.book.pk===this.storePk&&this.setActivePage(+this.$route.params.page)},methods:{...b(u,["getSettings","setActivePage"])}};function io(e,t,a,c,i,o){const n=Ie,p=Re;return o.vertical?(d(),h(n,{key:0,book:a.book},null,8,["book"])):(d(),h(p,{key:1,book:a.book},null,8,["book"]))}const De=m(ro,[["render",io]]);const lo={name:"BookChangeActivator",props:{direction:{type:String,required:!0}},computed:{...C(u,["prevBookChangeShow","nextBookChangeShow"]),show(){return this[this.computedDirection+"BookChangeShow"]},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...b(u,["setBookChangeFlag","normalizeDirection"])}};function co(e,t,a,c,i,o){return o.show?(d(),v("div",{key:0,class:B(["bookChangeColumn",{[a.direction]:!0}]),onClick:t[0]||(t[0]=W(n=>e.setBookChangeFlag(a.direction),["stop"]))},null,2)):S("",!0)}const $e=m(lo,[["render",co],["__scopeId","data-v-2a8ea6a5"]]);const uo={name:"BooksWindow",components:{BookChangeActivator:$e,PagesView:De},emits:["click"],computed:{...f(u,{books:e=>e.books,bookChange:e=>e.bookChange,activeBookPk:e=>e.pk,bookRoutes:e=>e.routes.books})},watch:{$route(e,t){(!t||!t.params||+e.params.pk!=+t.params.pk)&&this.loadBooks(e.params)}},beforeMount(){this.setBookChangeFlag()},created(){this.loadBooks(this.$route.params)},methods:{...b(u,["setBookChangeFlag","loadBooks"]),click(){this.setBookChangeFlag(),this.$emit("click")},eager(e){return this.bookChange&&this.bookRoutes[this.bookChange]&&this.bookRoutes[this.bookChange].pk===e}}};function go(e,t,a,c,i,o){const n=$e,p=De;return d(),h(le,{id:"booksWindow",direction:"vertical","model-value":e.activeBookPk,"show-arrows":"",onClick:o.click},{prev:l(()=>[s(n,{direction:"prev"})]),next:l(()=>[s(n,{direction:"next"})]),default:l(()=>[(d(!0),v(T,null,M(e.books,([_,R])=>(d(),h(ie,{key:`c/${_}`,class:"windowItem",disabled:"",eager:o.eager(_),value:_,transition:!0},{default:l(()=>[s(p,{book:R,onClick:o.click},null,8,["book","onClick"])]),_:2},1032,["eager","value"]))),128))]),_:1},8,["model-value","onClick"])}const Ve=m(uo,[["render",go],["__scopeId","data-v-2c89f99b"]]);const po={name:"ReaderTitleToolbar",components:{MetadataDialog:be,SettingsDrawerButton:Ke},data(){return{mdiClose:je,routeChanged:!1}},head(){return{meta:[{hid:"description",name:"description",content:`reader ${this.activeTitle} page ${this.storePage}`}]}},computed:{...C(u,["activeTitle","activeBook"]),...f(u,{bookChange:e=>e.bookChange,seriesPosition:function(e){return this.activeBook&&e.seriesCount>1?`${this.activeBook.seriesIndex}/${e.seriesCount}`:""},vertical:e=>e.activeSettings.vertical,pk:e=>e.pk||0}),...f(Ye,{lastRoute:e=>e.page.routes.last}),...de(D,["isSettingsDrawerOpen"]),closeBookRoute:function(){const e={name:"browser",params:this.lastRoute};return e.params?e.hash=`#card-${this.pk}`:e.params=window.CODEX.LAST_ROUTE||Xe.browser.route,e}},watch:{$route(e,t){t&&(this.routeChanged=!0)}},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...b(D,["setTimestamp"]),...b(u,["routeToDirection","routeToDirectionOne","routeToBook","setBookChangeFlag"]),openMetadata(){this.$refs.metadataDialog.dialog=!0},onCloseBook(){this.routeChanged&&this.setTimestamp()},_keyListener(e){switch(e.stopPropagation(),e.key){case"Escape":this.$refs.closeBook.$el.click();break;case"m":this.openMetadata();break}}}},_o={key:0},ho={key:0,id:"seriesPosition",title:"Series Position"};function mo(e,t,a,c,i,o){const n=be,p=y("SettingsDrawerButton");return d(),h(Ze,{id:"readerTopToolbar",class:"codexToolbar",density:"compact"},{default:l(()=>[s(q,null,{default:l(()=>[s(G,{id:"closeBook",ref:"closeBook",to:o.closeBookRoute,size:"large",onClick:o.onCloseBook},{default:l(()=>[e.$vuetify.display.smAndDown?(d(),h(P,{key:1,title:"Close Book"},{default:l(()=>[g(k(i.mdiClose),1)]),_:1})):(d(),v("span",_o,"close book"))]),_:1},8,["to","onClick"])]),_:1}),g(" "+k(e.bookChange)+" ",1),s(Je,{id:"toolbarTitle",class:"codexToolbarTitle"},{default:l(()=>[g(k(e.activeTitle),1)]),_:1}),e.seriesPosition?(d(),v("span",ho,k(e.seriesPosition),1)):S("",!0),s(q,null,{default:l(()=>[s(G,{id:"tagButton",onClick:W(o.openMetadata,["stop"])},{default:l(()=>[s(n,{ref:"metadataDialog",group:"c",pk:e.pk},null,8,["pk"])]),_:1},8,["onClick"]),s(p,{id:"settingsButton",onClick:t[0]||(t[0]=W(_=>e.isSettingsDrawerOpen=!0,["stop"]))})]),_:1})]),_:1})}const xe=m(po,[["render",mo],["__scopeId","data-v-02799b92"]]);const ko={name:"BookChangeDrawer",props:{direction:{type:String,required:!0}},head(){return Se([this.prefetchSrc1,this.prefetchSrc2])},computed:{...C(u,["prevBookChangeShow","nextBookChangeShow"]),...f(u,{prefetchSrc2(e){if(!this.params)return!1;const t=e.books.get(this.params.pk),a=this.getSettings(t);if(!this.isDrawerOpen||!this.params||!a.twoPages)return!1;const c={pk:this.params.pk,page:this.params.page+1};return I(c)},isDrawerOpen(e){return e.bookChange===this.computedDirection},params(e){return e.routes.books[this.computedDirection]},icon(){return this.computedDirection==="next"?se:ae}}),show(){return this[this.computedDirection+"BookChangeShow"]},prefetchSrc1(){return!this.isDrawerOpen||!this.params?!1:I(this.params)},route(){return this.params?{params:this.params}:{}},label(){return`${this.computedDirection==="prev"?"Previous":"Next"} Book`},computedDirection(){return this.normalizeDirection(this.direction)}},methods:{...b(u,["getSettings","normalizeDirection"])}};function vo(e,t,a,c,i,o){const n=y("router-link");return o.show?(d(),h(Qe,{key:0,class:B({bookChangeDrawer:!0,[a.direction]:!0}),"disable-resize-watcher":"","disable-route-watcher":"",location:o.computedDirection==="prev"?"left":"right","model-value":e.isDrawerOpen,scrim:!1,temporary:"",touchless:""},{default:l(()=>[s(n,{class:"navLink",to:o.route,"aria-label":o.label,title:o.label,onClick:t[0]||(t[0]=p=>p.stopImmediatePropagation())},{default:l(()=>[s(P,{class:"bookChangeIcon"},{default:l(()=>[g(k(e.icon),1)]),_:1})]),_:1},8,["to","aria-label","title"])]),_:1},8,["class","location","model-value"])):S("",!0)}const Le=m(ko,[["render",vo],["__scopeId","data-v-33b1e110"]]);const bo={name:"DownloadPanel",data(){return{mdiDownload:et,mdiFileImage:tt}},computed:{...C(u,["activeTitle"]),...f(u,{storePage:e=>e.page,pageSrc(e){const t={pk:e.pk,page:e.page};return ot(t)},downloadURL(e){return at(e.pk)}}),fileName:function(){let e=this.activeBook.fileType;return e=e.lower()?e:"unknown",this.activeTitle+"."+e},pageName:function(){return`${this.activeTitle} - page ${this.storePage}.jpg`}},methods:{...b(D,["downloadIOSPWAFix"]),...b(u,["activeBook"]),downloadPage(){this.downloadIOSPWAFix(this.pageSrc,this.pageName)},downloadBook(){this.downloadIOSPWAFix(this.downloadURL,this.fileName)}}},fo={id:"downloadPanel"};function Po(e,t,a,c,i,o){return d(),v("div",fo,[s(j,{onClick:o.downloadPage},{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[g(k(i.mdiFileImage),1)]),_:1}),g("Download Page "+k(e.storePage),1)]),_:1})]),_:1},8,["onClick"]),s(j,{onClick:o.downloadBook},{default:l(()=>[s(K,null,{default:l(()=>[s(P,null,{default:l(()=>[g(k(i.mdiDownload),1)]),_:1}),g("Download Book ")]),_:1})]),_:1},8,["onClick"])])}const Ee=m(bo,[["render",Po],["__scopeId","data-v-86f57eca"]]);const H=ue()({name:"VRadio",props:{...st({falseIcon:"$radioOff",trueIcon:"$radioOn"})},setup(e,t){let{slots:a}=t;return ge(()=>s(pe,L(e,{class:"v-radio",type:"radio"}),a)),{}}});const oe=ue()({name:"VRadioGroup",inheritAttrs:!1,props:{height:{type:[Number,String],default:"auto"},...nt(),...rt(it(),["multiple"]),trueIcon:{type:Y,default:"$radioOn"},falseIcon:{type:Y,default:"$radioOff"},type:{type:String,default:"radio"}},emits:{"update:modelValue":e=>!0},setup(e,t){let{attrs:a,slots:c}=t;const i=lt(),o=ct(()=>e.id||`radio-group-${i}`),n=dt(e,"modelValue");return ge(()=>{const[p,_]=ut(a),[R,$]=gt(e),[N,jo]=pe.filterProps(e),A=c.label?c.label({label:e.label,props:{for:o.value}}):e.label;return s(_t,L({class:"v-radio-group"},p,R,{modelValue:n.value,"onUpdate:modelValue":U=>n.value=U,id:o.value}),{...c,default:U=>{let{id:z,messagesId:Ne,isDisabled:Ae,isReadonly:Ue}=U;return s(T,null,[A&&s(_e,{id:z.value},{default:()=>[A]}),s(pt,L(N,{id:z.value,"aria-describedby":Ne.value,defaultsTarget:"VRadio",trueIcon:e.trueIcon,falseIcon:e.falseIcon,type:e.type,disabled:Ae.value,readonly:Ue.value,"aria-labelledby":A?z.value:void 0,multiple:!1},_,{modelValue:n.value,"onUpdate:modelValue":ze=>n.value=ze}),c)])}})}),{}}}),wo=["fitTo","twoPages","vertical","readInReverse"],So={name:"ReaderSettingsPanel",data(){return{isGlobalScope:!1}},computed:{...f(u,{fitToChoices(e){const t=[];for(const a of e.choices.fitTo)a.value&&t.push(a);return t},selectedSettings:function(e){return this.isGlobalScope||!e.activeBook?e.readerSettings:e.activeBook.settings},isClearSettingsButtonDisabled:function(e){if(this.isGlobalScope||!e.activeBook)return!0;for(const t of wo){const a=e.activeBook.settings[t];if(!e.choices.nullValues.has(a))return!1}return!0},verticalLabel(e){const t=e.activeBook&&e.activeBook.settings?e.activeBook.settings.vertical:void 0;return t==null?"Horizontal or Vertical":t?"Scroll Pages Vertically":"Turn Pages Horizontally"},params(e){return{pk:e.pk,page:e.page}}}),...de(u,["readRTLInReverse"])},mounted(){document.addEventListener("keyup",this._keyListener)},beforeUnmount(){document.removeEventListener("keyup",this._keyListener)},methods:{...b(u,["clearSettingsLocal","setSettingsGlobal","setSettingsLocal"]),settingsDialogChanged:function(e){this.isGlobalScope?this.setSettingsGlobal(this.params,e):this.setSettingsLocal(this.params,e)},_keyListener:function(e){e.stopPropagation();let t;switch(e.key){case"w":t={fitTo:"WIDTH"};break;case"h":t={fitTo:"HEIGHT"};break;case"s":t={fitTo:"SCREEN"};break;case"o":t={fitTo:"ORIG"};break;case"2":t={twoPages:!this.selectedSettings.twoPages};break;case"r":t={readInReverse:!this.selectedSettings.readInReverse};break;case"v":t={vertical:!this.selectedSettings.vertical}}t&&this.setSettingsLocal(this.params,t)}}},yo={id:"readerSettings"};function Co(e,t,a,c,i,o){return d(),v("div",yo,[s(oe,{modelValue:i.isGlobalScope,"onUpdate:modelValue":t[0]||(t[0]=n=>i.isGlobalScope=n),density:"compact",label:"Scope","hide-details":"auto"},{default:l(()=>[s(H,{label:"Only this comic",value:!1}),s(H,{label:"Default for all comics",value:!0})]),_:1},8,["modelValue"]),s(oe,{class:"displayRadioGroup",density:"compact",label:"Display","hide-details":"auto","model-value":e.selectedSettings.fitTo,"onUpdate:modelValue":t[1]||(t[1]=n=>o.settingsDialogChanged({fitTo:n}))},{default:l(()=>[(d(!0),v(T,null,M(e.fitToChoices,n=>(d(),h(H,{key:n.value,label:n.title,value:n.value},null,8,["label","value"]))),128))]),_:1},8,["model-value"]),s(F,{disabled:e.selectedSettings.vertical,class:"displayTwoPages",density:"compact",label:"Two pages","hide-details":"auto","model-value":e.selectedSettings.twoPages,"true-value":!0,indeterminate:e.selectedSettings.twoPages===null||e.selectedSettings.twoPages===void 0,"onUpdate:modelValue":t[2]||(t[2]=n=>o.settingsDialogChanged({twoPages:n}))},null,8,["disabled","model-value","indeterminate"]),s(_e,null,{default:l(()=>[g("Reading Direction")]),_:1}),s(ht,{class:"vertical",density:"compact",label:e.verticalLabel,"hide-details":"auto","model-value":e.selectedSettings.vertical,"true-value":!0,indeterminate:e.selectedSettings.vertical===null||e.selectedSettings.vertical===void 0,"onUpdate:modelValue":t[3]||(t[3]=n=>o.settingsDialogChanged({vertical:n}))},null,8,["label","model-value","indeterminate"]),s(F,{class:"readInReverse",density:"compact",label:"Read in Reverse","hide-details":"auto","model-value":e.selectedSettings.readInReverse,"true-value":!0,indeterminate:e.selectedSettings.readInReverse===null||e.selectedSettings.readInReverse===void 0,"onUpdate:modelValue":t[4]||(t[4]=n=>o.settingsDialogChanged({readInReverse:n}))},null,8,["model-value","indeterminate"]),i.isGlobalScope?(d(),h(F,{key:0,"model-value":e.selectedSettings.readRtlInReverse,class:"readRtlInReverse",density:"compact",label:"Read RTL comics in Reverse","hide-details":"auto","true-value":!0,"onUpdate:modelValue":t[5]||(t[5]=n=>o.settingsDialogChanged({readRtlInReverse:n}))},null,8,["model-value"])):S("",!0),i.isGlobalScope?S("",!0):(d(),h(G,{key:1,id:"clearSettingsButton",disabled:e.isClearSettingsButtonDisabled,title:"Use the default settings for all comics for this comic",onClick:t[6]||(t[6]=n=>e.clearSettingsLocal(e.params))},{default:l(()=>[g(" Clear Comic Settings ")]),_:1},8,["disabled"]))])}const Oe=m(So,[["render",Co],["__scopeId","data-v-f5b2d5eb"]]);const Ro={name:"KeyboardShortcutsPanel",data(){return{mdiMenuLeft:mt,mdiMenuRight:kt,mdiKeyboardOutline:vt,mdiKeyboardSpace:bt,mdiAppleKeyboardShift:ft}},computed:{...C(D,["isMobile"])}},w=e=>(Ct("data-v-eec6ebe0"),e=e(),Rt(),e),Bo=w(()=>r("h4",null,"Navigation",-1)),To={class:"highlight-table"},Io=w(()=>r("td",null,"Previous page",-1)),Do=w(()=>r("td",null,"Next page",-1)),$o=w(()=>r("tr",null,[r("td",null,","),r("td",null,[g("Next "),r("em",null,"only"),g(" one page in two page mode.")])],-1)),Vo=w(()=>r("tr",null,[r("td",null,"."),r("td",null,[g("Previous "),r("em",null,"only"),g(" one page in two page mode.")])],-1)),xo=w(()=>r("tr",null,[r("td",null,"p"),r("td",null,"Previous Book")],-1)),Lo=w(()=>r("tr",null,[r("td",null,"n"),r("td",null,"Next Book")],-1)),Eo=w(()=>r("h4",null,"Fit Page To",-1)),Oo=w(()=>r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"s"),r("td",null,"screen")]),r("tr",null,[r("td",null,"h"),r("td",null,"screen height")]),r("tr",null,[r("td",null,"w"),r("td",null,"screen width")]),r("tr",null,[r("td",null,"o"),r("td",null,"Show page at original size")]),r("tr",null,[r("td",null,"2"),r("td",null,"Toggle two page view")]),r("tr",null,[r("td",null,"r"),r("td",null,"Toggle Read in Reverse")])])],-1)),No=w(()=>r("h4",null,"Other",-1)),Ao=w(()=>r("table",{class:"highlight-table"},[r("tbody",null,[r("tr",null,[r("td",null,"m"),r("td",null,"Show comic's metadata")]),r("tr",null,[r("td",null,"esc"),r("td",null,"Close book")])])],-1));function Uo(e,t,a,c,i,o){return e.isMobile?S("",!0):(d(),h(yt,{key:0},{default:l(()=>[s(Pt,{id:"readerKeyboardShortcuts"},{default:l(()=>[s(wt,{id:"shortcutsTitle"},{default:l(()=>[s(P,{id:"keyboardIcon"},{default:l(()=>[g(k(i.mdiKeyboardOutline),1)]),_:1}),g("Keyboard Shortcuts ")]),_:1}),s(St,null,{default:l(()=>[Bo,r("table",To,[r("tbody",null,[r("tr",null,[r("td",null,[s(P,{class:"keyIcon",density:"compact"},{default:l(()=>[g(k(i.mdiMenuLeft),1)]),_:1}),g(", j, "),r("div",null,[s(P,{class:"keyIcon",density:"compact"},{default:l(()=>[g(k(i.mdiAppleKeyboardShift),1)]),_:1}),s(P,{class:"keyIcon",density:"compact"},{default:l(()=>[g(k(i.mdiKeyboardSpace),1)]),_:1})])]),Io]),r("tr",null,[r("td",null,[s(P,{class:"keyIcon",density:"compact"},{default:l(()=>[g(k(i.mdiMenuRight),1)]),_:1}),g(", k, "),s(P,{class:"keyIcon",density:"compact"},{default:l(()=>[g(k(i.mdiKeyboardSpace),1)]),_:1})]),Do]),$o,Vo,xo,Lo])]),Eo,Oo,No,Ao]),_:1})]),_:1})]),_:1}))}const zo=m(Ro,[["render",Uo],["__scopeId","data-v-eec6ebe0"]]),Fo={name:"ReaderSettingsSuperPanel",components:{DownloadPanel:Ee,ReaderKeyboardShortcutsPanel:zo,ReaderSettingsPanel:Oe}};function Ho(e,t,a,c,i,o){const n=Oe,p=y("ReaderKeyboardShortcutsPanel"),_=Ee;return d(),v(T,null,[s(n),s(X),s(p),s(X),s(_)],64)}const Wo=m(Fo,[["render",Ho]]);const Go={name:"MainReader",components:{BookChangeDrawer:Le,BooksWindow:Ve,ReaderNavToolbar:we,ReaderTitleToolbar:xe,SettingsDrawer:he},data(){return{showToolbars:!1,ReaderSettingsSuperPanel:ne(Wo)}},computed:{...C(J,["isCodexViewable"]),...f(J,{user:e=>e.user})},watch:{user(){this.loadReaderSettings()},isCodexViewable(){this.loadReaderSettings()}},created(){D().isSettingsDrawerOpen=!1,this.loadReaderSettings()},methods:{...b(u,["loadReaderSettings"]),toggleToolbars(){this.showToolbars=!this.showToolbars}}},Mo={key:0,id:"readerContainer"},qo={key:1,id:"announcement"};function Ko(e,t,a,c,i,o){const n=Le,p=xe,_=Ve,R=we,$=y("router-link"),N=he;return d(),v(T,null,[s(Bt,{id:"readerWrapper"},{default:l(()=>[s(n,{direction:"prev"}),e.isCodexViewable?(d(),v("div",Mo,[s(Tt,null,{default:l(()=>[E(s(p,null,null,512),[[Z,i.showToolbars]])]),_:1}),s(_,{onClick:o.toggleToolbars},null,8,["onClick"]),s(It,null,{default:l(()=>[E(s(R,null,null,512),[[Z,i.showToolbars]])]),_:1})])):(d(),v("div",qo,[r("h1",null,[s($,{to:{name:"home"}},{default:l(()=>[g(" Log in ")]),_:1}),g(" to read comics ")])]))]),_:1}),s(n,{direction:"next"}),s(N,{title:"Reader Settings",panel:i.ReaderSettingsSuperPanel,temporary:""},null,8,["panel"])],64)}const Jo=m(Go,[["render",Ko],["__scopeId","data-v-ee8b8c72"]]);export{Jo as default};
