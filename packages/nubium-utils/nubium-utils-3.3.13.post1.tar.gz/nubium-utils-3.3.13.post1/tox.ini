[tox]
minversion = 3.4.0
envlist = py{38,39},cov
isolated_build = True

[testenv]
setenv =
    py{38,39}: COVERAGE_FILE=.coverage.{envname}
deps = -r requirements.txt
commands =
    py{38,39}: pytest {posargs}
    cov: coverage combine --keep
    cov: coverage report --show-missing --fail-under=20

[testenv:build]
skip_install = True
deps =
    setuptools_scm
    wheel
commands =
    python setup.py sdist bdist_wheel

[testenv:build_reqs]
deps =
    pip-tools
    pip<22
skip_install = True
commands =
    pip-compile --extra dev

[testenv:upload]
deps =
    twine
passenv =
    PYPI_PASSWORD
    PYPI_USERNAME
skip_install = True
commands =
    twine upload --skip-existing --non-interactive --username "{env:PYPI_USERNAME}" --password "{env:PYPI_PASSWORD}" dist/*
