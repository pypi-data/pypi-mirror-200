import{s as q}from"./vue-virtual-scroller.esm-97474cac.js";/* empty css                             */import{d as A,e as H,G as J,r as u,c as k,z as L,o as O,A as Q,h as m,q as g,b as i,l as y,w as n,F as S,x as P,i as b,p as _,k as v,v as $,m as W,s as T,n as R,j as X,U as Y}from"./index-1c74b571.js";import{L as Z}from"./ListviewItem-7e8e5c36.js";import{_ as z,a as ee}from"./MediaItemContextMenu.vue_vue_type_style_index_0_lang-79d4053e.js";import{V as te,a as ae,b as le,c as se}from"./VSelect-5bb29ddd.js";import{V as re,a as oe}from"./VRow-6f08c5b5.js";import{V as ie}from"./VTooltip-a795f4eb.js";import{a as ue,l as ne}from"./VBtn-306d1a5a.js";import{V as me}from"./VToolbar-64dff615.js";import"./_plugin-vue_export-helper-a8c3528c.js";import"./MediaItemThumb.vue_vue_type_style_index_0_lang-e0f4d409.js";import"./VCardText-075e2ead.js";import"./ProviderIcon.vue_vue_type_script_setup_true_lang-e9e0e523.js";import"./VCard-301b9769.js";import"./forwardRefs-03e862ca.js";import"./VDivider-5c1f311f.js";import"./VMenu-c65b86e6.js";import"./VLabel-e18201d9.js";import"./VCheckboxBtn-55c47d49.js";import"./VDialog-7527502e.js";/* empty css              */const ve={style:{"margin-left":"15px","margin-right":"15px","margin-top":"20px","margin-bottom":"20px",padding:"0"}},pe={key:2},ce={style:{"margin-left":"15px"}},Ue=A({__name:"Search",props:{initSearch:null},setup(U){const x=U,N=H(),{mobile:D}=J(),s=u("list"),V=u(0),r=u(""),p=u(!1),l=u(),w=u(!1),c=u(!1),d=u([]),C=u(),M=["topresult","artists","albums","tracks","playlists"],E=k(()=>D.value?140:150),G=function(){s.value==="panel"?s.value="list":s.value="panel",localStorage.setItem(`viewMode.search.${o.value}`,s.value)},B=function(e){d.value=[e],c.value=!0},F=function(e){var t;["artist","album","playlist"].includes(e.media_type)||!((t=T.selectedPlayer)!=null&&t.available)?N.push({name:e.media_type,params:{itemId:e.item_id,provider:e.provider}}):T.selectedPlayer&&R.playMedia(e)};L(()=>r.value,()=>{clearTimeout(C.value),C.value=setTimeout(()=>{j()},200)});const K=function(e){return e<500?2:e<=500?3:e<=700?4:e<=1e3?5:e<=1200?6:e<=1500?7:e<=1700?8:e>1700?9:0},j=async function(){w.value=!0,localStorage.setItem("globalsearch",r.value),r.value?l.value=await R.search(r.value):l.value=void 0,w.value=!1},o=k(()=>M[V.value]),f=k(()=>{if(!l.value)return[];if(o.value=="artists")return l.value.artists;if(o.value=="albums")return l.value.albums;if(o.value=="tracks")return l.value.tracks;if(o.value=="playlists")return l.value.playlists;if(o.value=="radios")return l.value.radio;if(o.value=="topresult"){const e=[];for(const t of[l.value.tracks,l.value.artists,l.value.albums,l.value.playlists,l.value.radio]){const a=[];for(const h of t)a.includes(h.provider)||(e.push(h),a.push(h.provider))}return e}return[]});L(()=>o.value,e=>{if(e){const t=localStorage.getItem(`viewMode.search.${o.value}`);t?s.value=t:o.value=="artists"||o.value=="albums"?s.value="panel":s.value="list"}},{immediate:!0}),O(()=>{if(x.initSearch)r.value=x.initSearch;else{const e=localStorage.getItem("globalsearch");e&&e!=="null"&&(r.value=e)}});const I=function(e){c.value||(e.key==="a"&&(e.ctrlKey||e.metaKey)?(e.preventDefault(),d.value=f.value):!p.value&&e.key=="Backspace"?r.value=r.value.slice(0,-1):!p.value&&e.key.length==1&&(r.value+=e.key))};return document.addEventListener("keydown",I),Q(()=>{document.removeEventListener("keydown",I)}),(e,t)=>(m(),g("div",null,[i(te,{id:"searchInput",modelValue:r.value,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value=a),clearable:"","prepend-inner-icon":"mdi-magnify",label:e.$t("type_to_search"),"hide-details":"",variant:"filled",onFocus:t[1]||(t[1]=a=>p.value=!0),onBlur:t[2]||(t[2]=a=>p.value=!1)},null,8,["modelValue","label"]),y("div",null,[i(ae,{modelValue:V.value,"onUpdate:modelValue":t[3]||(t[3]=a=>V.value=a),column:"",style:{"margin-top":"15px","margin-left":"10px"}},{default:n(()=>[(m(),g(S,null,P(M,a=>i(se,{key:a,filter:"",outlined:""},{default:n(()=>[X($(e.$t(a)),1)]),_:2},1024)),64))]),_:1},8,["modelValue"]),i(z,{modelValue:c.value,"onUpdate:modelValue":t[4]||(t[4]=a=>c.value=a),items:d.value,onClear:t[5]||(t[5]=()=>{d.value=[]})},null,8,["modelValue","items"]),y("div",ve,[w.value?(m(),b(ne,{key:0,indeterminate:""})):_("",!0),s.value=="panel"?(m(),b(re,{key:1},{default:n(()=>[(m(!0),g(S,null,P(v(f),a=>(m(),b(oe,{key:a.uri,class:Y(`col-${K(e.$vuetify.display.width)}`)},{default:n(()=>[i(ee,{item:a,size:v(E),"is-selected":!1,"show-checkboxes":!1,onMenu:B,onClick:F},null,8,["item","size"])]),_:2},1032,["class"]))),128))]),_:1})):_("",!0),s.value=="list"?(m(),g("div",pe,[i(v(q),{items:v(f),"item-size":60,"key-field":"item_id","page-mode":""},{default:n(({item:a})=>[i(Z,{item:a,"show-track-number":!1,"show-duration":!0,"show-library":!1,"show-menu":!0,"show-providers":!0,"show-checkboxes":!1,"is-selected":!1,"show-details":!0,onMenu:B,onClick:F},null,8,["item"])]),_:1},8,["items"])])):_("",!0)]),i(me,{density:"compact",variant:"flat",color:"transparent",height:"45"},{default:n(()=>[y("span",ce,$(e.$t("items_total",[v(f).length])),1),i(le),i(ie,{location:"bottom"},{activator:n(({props:a})=>[i(ue,W(a,{icon:s.value=="panel"?"mdi-view-list":"mdi-grid",variant:"plain",onClick:t[6]||(t[6]=h=>G())}),null,16,["icon"])]),default:n(()=>[y("span",null,$(e.$t("tooltip.toggle_view_mode")),1)]),_:1})]),_:1})])]))}});export{Ue as default};
